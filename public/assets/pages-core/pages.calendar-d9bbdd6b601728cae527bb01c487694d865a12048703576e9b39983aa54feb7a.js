!function(e){function t(t,a){var r=e(this),s=r.data("pagescalendar"),i="object"==typeof t&&t;return"string"==typeof t?s[t](a):this.each(function(){s||r.data("pagescalendar",s=new n(this,i))})}var n=function(t,n){this.$element=e(t),this.$html='<div class="calendar">',this.$html+="<!-- START CALENDAR HEADER-->",this.$html+='<div class="calendar-header">',this.$html+='<div class="drager">',this.$html+='<div class="years" id="years"></div>',this.$html+="</div>",this.$html+="</div>",this.$html+='<div class="options">',this.$html+='<div class="months-drager drager">',this.$html+='<div class="months" id="months"></div>',this.$html+="</div>",this.$html+='<h4 class="semi-bold date" id="currentDate">&amp;</h4>',this.$html+='<div class="drager week-dragger">',this.$html+='<div class="weeks-wrapper" id="weeks-wrapper">',this.$html+=" </div>",this.$html+="</div>",this.$html+="</div>",this.$html+="<!-- START CALENDAR GRID-->",this.$html+='<div id="calendar" class="calendar-container">',this.$html+="</div>",this.$html+="<!-- END CALENDAR GRID-->",this.$html+="</div>",this.$element.append(this.$html);var a=this;a.settings=e.extend(!0,{},e.fn.pagescalendar.defaults,n);var r=r||{},r={getEventByID:function(e){for(var t=0;t<this.events.length;t++)if(Calendar.settings.events[t]._id==e)return setting.events[t];return null},getEventsByDate:function(e){e=moment(e).format("YYYY-MM-DD");for(var t=0;t<this.events.length;t++){var n=moment(Calendar.settings.events[t].start).format("YYYY-MM-DD");if(0==e.localeCompare(n))return setting.events[t]}return null},getAllEvents:function(){return this.events},addEvent:function(){this.events.push(event)},lazyFetch:function(){},byDateRange:function(e,t){for(var n=moment(e).format("YYYY-MM-DD"),a=moment(t).add(24,"hours").format("YYYY-MM-DD"),r=moment.range(n,a),s=[],i=0;i<Calendar.settings.disableDates.length;i++){var d=moment(Calendar.settings.disableDates[i]);d.within(r)&&s.push(Calendar.settings.disableDates[i])}for(var o=[],i=0;i<Calendar.settings.events.length;i++){var d=moment(Calendar.settings.events[i].start);if(d.within(r)){for(var l=!1,c=0;c<s.length;c++){var m=moment(s[c]).format("YYYY-MM-DD"),h=moment.range(m,moment(m).add(24,"hours"));if(d.within(h)){l=!0;break}}l||o.push(i)}}return o},hasEventByDate:function(e,t){e=moment(e).format(t);for(var n=0;n<Calendar.settings.events.length;n++){var a=moment(Calendar.settings.events.start).format(t);if(0==e.localeCompare(a))return!0}return!1},eventCountByDate:function(e,t){e=moment(e).format(t);for(var n=0,a=0;a<Calendar.settings.events.length;a++){var r=moment(Calendar.settings.events.start).format(t);0==e.localeCompare(r)&&n++}return n},getDisableDateIndexInDateRange:function(e,t,n){e=moment(e).format("YYYY-MM-DD"),t=moment(t).format("YYYY-MM-DD");for(var a=moment.range(e,t),r=[],s=0;s<Calendar.settings.disableDates.length;s++){moment(Calendar.settings.disableDates[s]).within(a)&&r.push(moment(Calendar.settings.disableDates[s]).format(n))}return r},eventCountByDateRange:function(e,t){for(var n=moment(e).format("YYYY-MM-DD"),a=moment(t).format("YYYY-MM-DD"),r=moment.range(n,a),s=[],i=0;i<Calendar.settings.events.length;i++){moment(Calendar.settings.events[i].start).within(r)&&s++}return s}},s=function(){function t(e){this.container=e,this.render()}var n=function(){var t=calendar.year-Calendar.settings.ui.year.startYear;e(".year a").removeClass("active"),e(".year:nth-child("+t+") > a").addClass("active")},a=function(){e(document).off("click","body:not(.pending) .year-selector"),e(document).on("click","body:not(.pending) .year-selector",function(){var t=e(this).attr("data-year");calendar.year=moment(t,Calendar.settings.ui.year.format).year(),n(),Calendar._onYearChange()})};return t.prototype.render=function(){e(this.container).html(""),Calendar.content="";var t=Calendar.settings.ui.year.endYear-Calendar.settings.ui.year.startYear;t=t>90?90:t;for(var r=Calendar.settings.ui.year.startYear,s=1;s<=t;s++){r=moment(r,Calendar.settings.ui.year.format).add(1,"year").format(Calendar.settings.ui.year.format);var i=calendar.year==r?"active":"";Calendar.content+='<div class="year">',Calendar.content+='<a style="CURSOR: pointer" class="year-selector '+i+'" data-year='+r+">"+r+"</a>",Calendar.content+="</div>"}e(this.container).append(Calendar.content),Calendar.dragHandler("years"),n(),a()},t}(),i=function(e){this.container=e,this.render()};i.prototype={render:function(){e(this.container).html(""),Calendar.content="";for(var t=moment.monthsShort(),n=moment([calendar.year,calendar.month,calendar.date]).format(Calendar.settings.ui.month.format),a=0;a<t.length;a++){var r=moment(t[a],"MMMM").format(Calendar.settings.ui.month.format),s=n==r?"active":"";Calendar.content+='<div class="month">',Calendar.content+='<a style="CURSOR: pointer;" class="month-selector '+s+'" data-month="'+r+'">'+r+"</a>",Calendar.content+="</div>"}e(this.container).append(Calendar.content),Calendar.dragHandler("months"),this._bindEvents()},_setActive:function(){e(".month a").removeClass("active"),e(".month:nth-child("+(parseInt(calendar.month)+1)+") > a").addClass("active")},_bindEvents:function(){var t=this;e(document).off("click","body:not(.pending) .month-selector"),e(document).on("click","body:not(.pending) .month-selector",function(){var n=e(this).attr("data-month");calendar.month=moment(n,Calendar.settings.ui.month.format).month(),Calendar.daysOfMonth=moment([calendar.year,calendar.month]).daysInMonth(),Calendar.daysOfMonth<calendar.date&&(calendar.date=Calendar.daysOfMonth),Calendar._onMonthChange(),t._setActive()})}};var d=function(e){this.container=e,this.render(),this._bindEvents()};d.prototype={render:function(){function t(){Calendar.content+='<div class="day-wrapper date-selector">',Calendar.content+='<div class="week-day">',Calendar.content+='<div class="day week-header">'+s.format(Calendar.settings.ui.week.header.format)+"</div>",Calendar.content+="</div>",Calendar.content+='<div class="week-date '+d+'">',Calendar.content+='<div class="day"><a href="#" data-date='+s.format(Calendar.settings.ui.week.day.format)+">"+r+"</a></div>",Calendar.content+="</div>",Calendar.content+="</div>"}e(this.container).html(""),Calendar.daysOfMonth=moment([calendar.year,calendar.month]).daysInMonth(),Calendar.content="";for(var n=parseInt(moment(Calendar.settings.ui.week.startOfTheWeek,"d").format("d")),a=parseInt(moment(Calendar.settings.ui.week.endOfTheWeek,"d").format("d")),r=1;r<=Calendar.daysOfMonth;r++){var s=moment([calendar.year,calendar.month,r]),i=parseInt(moment([calendar.year,calendar.month,r]).format("d")),d=calendar.date==r?"active current-date":"";(i==n||1==r)&&(Calendar.content+='<div class="week '+d+'">'),n>=a?(i>=n||i==a)&&t():i>=n&&i<=a&&t(),i==a&&(Calendar.content+="</div>")}Calendar.content+="</div>",e(this.container).append(Calendar.content),e(".weeks-wrapper .week .day-wrapper .week-date.active").closest(".week").addClass("active"),Calendar.dragHandler("weeks-wrapper")},_setActive:function(){e(".week").removeClass("active"),e(elem).closest(".week").addClass("active")},_bindEvents:function(){e(document).off("click","body:not(.pending) .date-selector"),e(document).on("click","body:not(.pending) .date-selector",function(){e(".week-date").removeClass("active"),e(this).children(".week-date").addClass("active"),calendar.date=parseInt(e(this).children(".week-date").children(".day").children("a").attr("data-date")),Calendar._onDayChange()})}};var o=function(e){this.grid=null,this.miniCalendar=null,this.layout=e,this.build()};o.prototype.build=function(){switch(this.layout){case"month":this.grid=new m(".calendar-container");break;case"week":case"day":this.miniCalendar=new d(".weeks-wrapper"),this.grid=new c(".calendar-container",this.layout)}},o.prototype.refresh=function(){return this.grid.refresh()},o.prototype.rebuild=function(){this.build()},o.prototype.reloadEvents=function(){this.grid.reloadEvents()},o.prototype.doubletap=function(e){return this.grid.doubletap(e)},o.prototype.getCurrentDateRange=function(){return this.grid.getCurrentDateRange()},o.prototype.scrollToFirstEvent=function(){return this.grid.scrollToFirstEvent()};var l=function(e){this.container=e},c=function(e,t){this.layout=t,l.call(this,e),this.render(),this.snapGridWidth=null,this.snapGridHeight=null};c.prototype=Object.create(l.prototype),c.prototype.render=function(){this.weekStart=parseInt(moment(Calendar.settings.ui.week.startOfTheWeek,"d").format("d")),this.weekEnd=parseInt(moment(Calendar.settings.ui.week.endOfTheWeek,"d").format("d")),this.startOfWeek=moment([calendar.year,calendar.month,calendar.date]).startOf("week"),this.weekStart>=this.weekEnd?this.endOfWeek=moment([calendar.year,calendar.month,calendar.date]).startOf("week").add("days",7+Calendar.settings.ui.week.endOfTheWeek):this.endOfWeek=moment([calendar.year,calendar.month,calendar.date]).startOf("week").add("days",Calendar.settings.ui.week.endOfTheWeek),this._buildLayout(),this._timeslots(),this._loadDates(),this._bindEventDraggers(),this._setActive(),this.windowResize(),Calendar.settings.ui.grid.scrollToFirstEvent&&this.scrollToFirstEvent()},c.prototype._buildLayout=function(){var t='<div class="thead" >',n=this.weekEnd;this.weekStart>=this.weekEnd&&(n=7);for(var a=this.weekStart;a<=n;a++)t+='<div class="tcell"></div>';t+="</div>",e(this.container).html(""),Calendar.content="",Calendar.content+='<div class="view '+this.layout+'-view">',Calendar.content+='<div class="allday-cell">',Calendar.content+="</div>",Calendar.content+='<div class="tble" id="viewTableHead">',Calendar.content+=t,Calendar.content+="</div>",Calendar.content+='<div class="grid slot-'+Calendar.settings.slotDuration+'">',Calendar.content+='<div class="time-slot-wrapper" id="time-slots">',Calendar.content+="</div>",Calendar.content+='<div class="tble" id="weekGrid">';for(var r=parseInt(Calendar.settings.slotDuration),s=60/Math.round(r)-1,i=Calendar.settings.minTime;i<Calendar.settings.maxTime;i++){Calendar.content+='<div class="trow" >';for(var a=this.weekStart;a<=n;a++){Calendar.content+='<div class="tcell">',Calendar.content+='<div class="cell-inner" data-time-slot="'+i+':00" ></div>';for(var d=0,o=0;o<s;o++)Calendar.content+='<div class="cell-inner" data-time-slot="'+i+":"+(d+=r)+'" ></div>';Calendar.content+="</div>"}Calendar.content+="</div>"}Calendar.content+="</div>",Calendar.content+="</div>",Calendar.content+="</div>",e(this.container).append(Calendar.content),Calendar.cellHeight=e(".tcell").innerHeight(),calendar.startOfWeekDate=moment([calendar.year,calendar.month,calendar.date]).startOf("week"),calendar.endOfWeek=moment([calendar.year,calendar.month,calendar.date]).endOf("week").format("D"),this.maxMinsPerDay=moment(Calendar.settings.maxTime+":00",["H:mm"]).diff(moment(Calendar.settings.minTime+":00",["H:mm"]),"minutes"),e(".calendar").removeClass("month").addClass("week")},c.prototype._loadDates=function(){var t=1,n=this.weekEnd;this.weekStart>=this.weekEnd&&(n=7);for(var a=this.weekStart;a<=n;a++){var r=moment(this.startOfWeek).add(a,"days");e("#viewTableHead").find(".thead .tcell:nth-child("+t+")").html('<div class="weekdate">'+moment(r).format("D")+'</div><div class="weekday">'+moment(r).format("dddd")+"</div>").attr("data-day",moment(r).format("YYYY-MM-DD")),t++}calendar.startOfWeekDate=moment([calendar.year,calendar.month,calendar.date]).startOf("week"),this.showDisableDates(),this._drawEvent()},c.prototype.renderEvent=function(t,n,r,s,i,d){var o=Math.round(moment(t+":"+n,["H:mm"]).diff(moment("0:00",["H:mm"]),"minutes")/Calendar.settings.slotDuration)*Calendar.settings.slotDuration,l=this.maxMinsPerDay-o,c=Math.round(n/Calendar.settings.slotDuration)*Calendar.settings.slotDuration;60==c&&(t=parseInt(t)+1,c=0),c/=Calendar.settings.slotDuration;var m=e(e(".tble .cell-inner[data-time-slot='"+t+":00']")[i]).parent(),h=moment(Calendar.settings.events[d].end).diff(Calendar.settings.events[d].start,"minutes");h=Math.round(h/Calendar.settings.slotDuration)*Calendar.settings.slotDuration;for(var v,u=h;u>0;)u>this.maxMinsPerDay?(v=l/Calendar.settings.slotDuration*this.snapGridHeight,u-=l,u=Math.round(u/Calendar.settings.slotDuration)*Calendar.settings.slotDuration,e(m.children()[c]).append(this._buildEventElement(v,d,i,t,n,r,s)),t=0,n=0,i=parseInt(i)+1,m=e(e(".tble .cell-inner[data-time-slot='"+t+":00']")[i]).parent()):(v=u/Calendar.settings.slotDuration*this.snapGridHeight,u=0,e(m.children()[c]).append(this._buildEventElement(v,d,i,t,n,r,s)));a.settings.onEventRender.call(this)},c.prototype._buildEventElement=function(e,t,n,a){e="height:"+e+"px;";var r="ca_"+moment(Calendar.settings.events[t].start).unix()+t,s=1==Calendar.settings.events[t].readOnly?"readonly":"",i="<div class='event-container "+Calendar.settings.events[t]["class"]+" "+s+"' data-event-duration="+moment(Calendar.settings.events[t].end).diff(Calendar.settings.events[t].start,"minutes")+" data-index="+t+" data-startTime="+Calendar.settings.events[t].start+" data-endTime="+Calendar.settings.events[t].end+" id="+r+" data-id="+r+" data-row="+parseInt(a)+" data-cell="+n+" style="+e+">";return i+="<div class='event-inner'>",i+="<div class='event-title'>"+Calendar.settings.events[t].title+"</div>",i+="<div class='time-wrap'><span class='event-start-time'>"+moment(Calendar.settings.events[t].start).format(Calendar.settings.timeFormat)+"</span> - ",i+="<span class='event-end-time'>"+moment(Calendar.settings.events[t].end).format(Calendar.settings.timeFormat)+"</span></div>",i+="</div>",0!=Calendar.settings.events[t].readOnly&&Calendar.settings.events[t].readOnly!=undefined||(i+="<div class='resizable-handle'></div>"),i+="</div>",Calendar.settings.events[t].dataID=r,i},c.prototype._drawEvent=function(){this.snapGridWidth=parseInt(e(".tcell").outerWidth()),this.snapGridHeight=parseInt(e(".cell-inner").outerHeight());this.weekEnd;this.weekStart,this.weekEnd;var t=r.byDateRange(this.startOfWeek,this.endOfWeek);e("#weekGrid").find(".event-container").remove(),e(".tble > .thead > .tcell").find(".event-bubble").remove();for(var n=0;n<t.length;n++){var a,s,i=t[n],d=moment(Calendar.settings.events[i].start),o=moment(Calendar.settings.events[i].start).format("e")-parseInt(Calendar.settings.ui.week.startOfTheWeek),l=d.format("H"),c=d.format("m");null==Calendar.settings.events[i].end?(a=parseInt(l)+1,s="0"):(a=moment(Calendar.settings.events[i].end).format("H"),s=moment(Calendar.settings.events[i].end).format("m"));var m=moment(a+":"+s,"h:mm").diff(moment(l+":"+c,"h:mm"),"minutes",!0);Calendar.settings.ui.grid.eventBubble&&null!=Calendar.settings.events[i]["class"]&&this._setEventBubble(Calendar.settings.events[i]["class"],o),this.renderEvent(l,c,a,s,o,i,m)}0==Calendar.settings.eventOverlap&&this.collisionGroups(t),this.setEventBubbles(Calendar.settings.events)},c.prototype.collisionGroups=function(t){function n(e){for(var t=e.concat(),n=t.length,a=0;a<t.length;++a)for(var r=a+1;r<t.length;++r)t[a]===t[r]&&t.splice(r--,1);return n!=t.length?t:[]}for(var a=[],r=1;r<t.length;r++){var s=moment.range(Calendar.settings.events[t[r]].start,Calendar.settings.events[t[r]].end),i=r-1;do{var d=[];event2Range=moment.range(Calendar.settings.events[t[i]].start,Calendar.settings.events[t[i]].end),s.overlaps(event2Range)&&(d.push(t[r]),d.push(t[i]),a.push(d)),i--}while(0===i)}for(var r=0;r<a.length;++r)for(var i=r+1;i<a.length;++i){var o=n(a[r].concat(a[i]));o.length>0&&(a[i]=o,a.splice(r,1),i--)}for(var r=0;r<a.length;r++)for(var l=100/a[r].length,c=0,i=0;i<a[r].length;i++){var m=e(".event-container[data-index='"+a[r][i]+"']");m.css({width:l+"%",left:c+"%"}),c+=l}},c.prototype._bindEventDraggers=function(){var t=0,n=0,r=0,s=e("#weekGrid")[0],i=this.snapGridHeight,d=this.snapGridWidth,o=this;interact(".event-container:not(.readonly)").draggable({snap:{targets:[interact.createSnapGrid({x:this.snapGridWidth,y:this.snapGridHeight})]},inertia:!0,restrict:{restriction:s,elementRect:{top:0,left:0,bottom:0,right:0},endOnly:!0},autoScroll:!0,onmove:function(e){t+=e.dy/i*Calendar.settings.slotDuration,n+=e.dx/d,Calendar.dragMoveListener(e),e.target.classList.add("dragging")},onend:function(r){var s=r.target;s=e(s);var i=e(s).data(),d=Calendar.constructEventForUser(i.index);if(d.readOnly)return void o._drawEvent();d.start=moment(d.start).add(n,"days"),d.start=moment(d.start).add(t,"minutes").format(),d.end=moment(d.start).add(s.attr("data-event-duration"),"minutes").format(),Calendar.settings.events[i.index]=d,t=0,n=0,r.target.classList.remove("dragging"),o._drawEvent(),a.settings.onEventDragComplete(d)}}).resizable({edges:{left:!1,right:!0,bottom:!0,top:!1},snap:{targets:[interact.createSnapGrid({x:this.snapGridWidth,y:this.snapGridHeight})]}}).on("resizemove",function(t){var a=t.target,s=t.rect.height;if(s<i&&(s=i,t.rect.height=i),0!=t.dx){n+=t.dx/this.snapGridWidth;var d=(e(a),e(a).data()),o=Calendar.constructEventForUser(d.index),l=moment(o.start).format("H");r=24-l,s=80*r}r=s/i*Calendar.settings.slotDuration,a.style.height=s+"px"}).on("resizeend",function(t){var s=t.target,i=(e(s),e(s).data()),d=Calendar.constructEventForUser(i.index);if(d.readOnly)return void o._drawEvent();d.end=moment(d.end).add(r,"minutes").format(),r=0,n=0,Calendar.settings.events[i.index]=d,o._drawEvent(),a.settings.onEventDragComplete(d)})},c.prototype._setEventBubble=function(t,n){var a=e("#viewTableHead").find(".thead .tcell:nth-child("+(parseInt(n)+1)+")");0==a.children("."+t).length&&a.append('<div class="event-bubble '+t+'"></div>')},c.prototype._timeslots=function(){var t="#time-slots";Calendar.content="";for(var n=Calendar.settings.minTime;n<Calendar.settings.maxTime;n++)Calendar.content+='<div class="time-slot"><span>'+moment().hour(n).format(Calendar.settings.ui.grid.timeFormat)+"</span></div>";e(t).append(Calendar.content)},c.prototype._setActive=function(){e("#viewTableHead").find(".thead .tcell").removeClass("active"),e("#weekGrid").find(".trow .tcell").removeClass("active");var t=moment([calendar.year,calendar.month,calendar.date]).format("e"),n=parseInt(t)+(1-parseInt(Calendar.settings.ui.week.startOfTheWeek));e("#viewTableHead").find(".thead .tcell:nth-child("+n+")").addClass("active"),e("#weekGrid").find(".trow .tcell:nth-child("+n+")").addClass("active")},c.prototype.scrollToFirstEvent=function(){var t=r.byDateRange(this.startOfWeek,this.endOfWeek);if(0==t.length)return!1;var n=e(".cell-inner [data-index='"+t[0]+"']"),a=e(".calendar .calendar-container .grid"),s=e(".calendar .calendar-container .grid").get(0).getBoundingClientRect(),i=n.get(0).getBoundingClientRect(),d=i.top-s.top-Calendar.settings.ui.grid.scrollToGap,o=a.scrollTop();a.animate({scrollTop:o+d},Calendar.settings.ui.grid.scrollToAnimationSpeed)},c.prototype.doubletap=function(t){var n=e(t),a=e("#viewTableHead").find(".thead .tcell:nth-child("+(n.parent().index()+1)+")").attr("data-day"),r=moment(n.attr("data-time-slot"),["H:mm"]).format(" H:mm");return a=moment(a+r,"YYYY/MM/D h:mm").format(),{date:a}},c.prototype.showDisableDates=function(){e(".tble .trow .tcell").removeClass("disable").children(".cell-inner").removeClass("disable"),this.disableDates=r.getDisableDateIndexInDateRange(this.startOfWeek,this.endOfWeek,"e");for(var t=0;t<this.disableDates.length;t++)e(".tble .trow .tcell:nth-child("+(parseInt(this.disableDates[t])+1)+")").addClass("disable").children(".cell-inner").addClass("disable")},c.prototype.refresh=function(){this.weekStart=parseInt(moment(Calendar.settings.ui.week.startOfTheWeek,"d").format("d")),this.weekEnd=parseInt(moment(Calendar.settings.ui.week.endOfTheWeek,"d").format("d")),this.startOfWeek=moment([calendar.year,calendar.month,calendar.date]).startOf("week"),this.endOfWeek=moment([calendar.year,calendar.month,calendar.date]).startOf("week").add("days",Calendar.settings.ui.week.endOfTheWeek),this._loadDates(),this._setActive();var e=[this.startOfWeek,this.endOfWeek];return this.setEventBubbles(Calendar.settings.events),e},c.prototype.reloadEvents=function(){this._drawEvent()},c.prototype.rebuild=function(){this.grid._buildLayout(),this.refresh()},c.prototype.windowResize=function(){var t=this;e(window).resize(function(){t.snapGridWidth=parseInt(e(".tcell").outerWidth()),t._bindEventDraggers()})},c.prototype.getCurrentDateRange=function(){return[this.startOfWeek,this.endOfWeek]},c.prototype.setEventBubbles=function(){e(".has-event").removeClass("has-event");for(var t in Calendar.settings.events){var n=moment(Calendar.settings.events[t].start).format(Calendar.settings.ui.year.format),a=moment(Calendar.settings.events[t].start).format(Calendar.settings.ui.month.format),r=moment(Calendar.settings.events[t].start).format("D");Calendar.settings.ui.year.eventBubble&&e('.year > [data-year="'+n+'"]').addClass("has-event"),calendar.year==moment(Calendar.settings.events[t].start).format("YYYY")&&(Calendar.settings.ui.month.eventBubble&&e('.month > [data-month="'+a+'"]').addClass("has-event"),calendar.month+1==moment(Calendar.settings.events[t].start).format("M")&&Calendar.settings.ui.week.eventBubble&&e('.date-selector > .week-date > .day > [data-date="'+r+'"]').addClass("has-event"))}};var m=function(e){this.monthViewStartDate="",this.monthViewEndDate="",l.call(this,e),this.gridElem="",this.render()};return m.prototype=Object.create(l.prototype),m.prototype.render=function(){this.weekStart=parseInt(moment(Calendar.settings.ui.week.startOfTheWeek,"d").format("d")),this.weekEnd=parseInt(moment(Calendar.settings.ui.week.endOfTheWeek,"d").format("d")),this.startOfWeek=moment([calendar.year,calendar.month,calendar.date]).startOf("week"),this.endOfWeek=moment([calendar.year,calendar.month,calendar.date]),this._buildLayout(),this._loadDates(),this._bindEvents(),this.bindEventDraggers()},m.prototype._buildLayout=function(){for(var t='<div class="thead" >',n=this.weekStart;n<=this.weekEnd;n++)t+='<div class="tcell"></div>';t+="</div>",e(this.container).html(""),Calendar.content="",Calendar.content+='<div class="view month-view">',Calendar.content+='<div class="tble" id="viewTableHead">',Calendar.content+=t,Calendar.content+="</div>",Calendar.content+='<div class="grid">',Calendar.content+='<div class="tble" id="monthGrid">';for(var a=0;a<5;a++){Calendar.content+='<div class="trow" >';for(var n=this.weekStart;n<=this.weekEnd;n++)Calendar.content+='<div class="tcell">',Calendar.content+='<div class="month-date"></div>',Calendar.content+='<div class="cell-inner"><div class="holder"></div></div>',Calendar.content+="</div>";Calendar.content+="</div>"}Calendar.content+="</div>",Calendar.content+="</div>",Calendar.content+="</div>",e(this.container).append(Calendar.content),cellHeight=e(".tcell").innerHeight(),calendar.startOfWeekDate=moment([calendar.year,calendar.month,calendar.date]).startOf("week"),calendar.endOfWeek=moment([calendar.year,calendar.month,calendar.date]).endOf("week").format("D"),this.snapGridWidth=parseInt(e(".tcell").outerWidth()),this.snapGridHeight=parseInt(e(".cell-inner").outerHeight()),this.holderHeight=parseInt(e(".holder").outerHeight()),e(".calendar").removeClass("week").addClass("month")},m.prototype._loadDates=function(){e(".tcell").removeClass("not active current-date"),e(".month-date").removeClass("not active current-date");for(var t=1,n=this.weekStart;n<=this.weekEnd;n++){var a=moment(this.startOfWeek).add(n,"days");e("#viewTableHead").find(".thead .tcell:nth-child("+t+")").html('</div><div class="weekday">'+moment(a).format("dddd")+"</div>").attr("data-day",moment(a).format("YYYY-MM-DD")),t++}calendar.startOfWeekDate=moment([calendar.year,calendar.month,calendar.date]).startOf("week");var r=moment([calendar.year,calendar.month,calendar.date]).startOf("month").startOf("week");this.monthViewStartDate=moment([calendar.year,calendar.month,calendar.date]).startOf("month").startOf("week");var s=null;this.gridElem=e(this.container).find(".view .grid");for(var n=1;n<=5;n++)for(var i=this.weekStart;i<=this.weekEnd;i++){var d=parseInt(r.format("M"))-1;calendar.month!=d&&(s="not"),calendar.date==r.format("D")&&calendar.month==d&&(s="current-date active"),this.gridElem.find(".tble .trow:nth-child("+n+") .tcell:nth-child("+(i+1)+")").addClass(s).attr("data-date",r.format("YYYY-MM-DD")).children(".month-date").html(r.format("D")).addClass(s),r=r.add(1,"days"),s=""}this.monthViewEndDate=r,this._showDisableDates(),this._drawEvent(),this.setEventBubbles()},m.prototype._bindEvents=function(){var t=this;e(".month-view .tcell").off("click"),e(".month-view .tcell").on("click",function(){var n=moment(e(this).attr("data-date"));calendar.date=n.format("D"),calendar.month=parseInt(n.format("M"))-1,t.setActive(e(this)),Calendar._buildCurrentDateHeader()})},m.prototype._drawEvent=function(){var t=r.byDateRange(this.monthViewStartDate.format("YYYY-MM-DD"),this.monthViewEndDate.format("YYYY-MM-DD"));e("#monthGrid").find(".event-container").remove(),e("#monthGrid").find(".ghost-element").remove();for(var n=0;n<t.length;n++){var a=t[n],s=e(".tble [data-date='"+moment(Calendar.settings.events[a].start).format("YYYY-MM-DD")+"']"),i=moment(moment(Calendar.settings.events[a].end)).diff(moment(Calendar.settings.events[a].start),"days");i=i=0===i?1:i,this.renderEvent(s,a,i)}},m.prototype.renderEvent=function(e,t,n){var r=(parseInt(n),"style='width:100%'"),s="ca_"+moment(Calendar.settings.events[t].start).unix()+t,i=1==Calendar.settings.events[t].readOnly?"readonly":"",d="<div class='event-container "+Calendar.settings.events[t]["class"]+" "+i+"' "+r+" data-index="+t+" data-startTime="+Calendar.settings.events[t].start+" data-endTime="+Calendar.settings.events[t].end+" id="+s+" data-id="+s+">";d+="<div class='event-inner'>",d+="<div class='event-title'>"+Calendar.settings.events[t].title+"</div>",d+="</div>",d+="</div>",e.children(".cell-inner").children(".holder").append(d),Calendar.settings.events[t].dataID=s,a.settings.onEventRender.call(this)},m.prototype.doubletap=function(t){var n=e(t).parent();return{date:moment(n.attr("data-date")).format()}},m.prototype.bindEventDraggers=function(){var t=e("#monthGrid")[0],n=null,r=this;interact(".event-container:not(.readonly)").draggable({inertia:!0,restrict:{restriction:t,elementRect:{top:0,left:0,bottom:1,right:1},endOnly:!0,drag:""},mode:"anchor",anchors:[],autoScroll:!0,onmove:function(e){Calendar.dragMoveListener(e),e.target.classList.add("dragging")},onend:function(e){e.target.classList.remove("dragging")}}).snap({mode:"anchor",anchors:[],range:Infinity,elementOrigin:{x:.5,y:.5},endOnly:!0}).on("dragstart",function(e){if(!n){var t=interact.getElementRect(e.target);n={x:t.left+t.width/2,y:t.top+t.height/2}}e.interactable.snap({anchors:[n]})}),interact(".tcell").dropzone({overlap:"center",accept:".event-container"}).on("dragenter",function(t){var n=interact.getElementRect(e(t.target).children(".cell-inner").children(".holder")[0]),a=interact.getElementRect(t.relatedTarget),r={x:n.left+a.width/2,y:n.top+a.height/2};t.draggable.snap({anchors:[r]});t.relatedTarget;t.target.classList.add("drop-target")}).on("dragleave",function(t){t.draggable.snap(!1),t.draggable.snap({anchors:[n]}),t.target.classList.remove("drop-target"),e(t.target).find(".ghost-element").remove()}).on("dropactivate",function(){}).on("dropdeactivate",function(e){e.target.classList.remove("drop-active"),e.target.classList.remove("drop-target")}).on("drop",function(t){var n=t.target,s=t.relatedTarget;n=e(n),s=e(s);var i=s.data(),d=Calendar.constructEventForUser(i.index);if(d.readOnly)return void r._drawEvent();d.start=moment(d.start).set("month",moment(n.attr("data-date")).get("month")).format(),d.start=moment(d.start).set("date",moment(n.attr("data-date")).get("date")).format(),d.end=moment(d.end).set("date",moment(n.attr("data-date")).get("date")).format(),Calendar.settings.events[i.index]=d,r._drawEvent(),a.settings.onEventDragComplete(d)})},m.prototype._showDisableDates=function(){e(".tble .trow .tcell").removeClass("disable").children(".cell-inner").removeClass("disable"),this.disableDates=r.getDisableDateIndexInDateRange(this.monthViewStartDate.format("YYYY-MM-DD"),this.monthViewEndDate.format("YYYY-MM-DD"),"YYYY-MM-DD");for(var t=0;t<this.disableDates.length;t++)e(".tble .trow .tcell[data-date='"+this.disableDates[t]+"']").addClass("disable").children(".cell-inner").addClass("disable")},m.prototype.setActive=function(t){e(".month-view .tcell").children(".month-date").removeClass("active"),t.children(".month-date").addClass("active")},m.prototype.refresh=function(){return this._loadDates(),this._drawEvent(),[this.monthViewStartDate,this.monthViewEndDate]},m.prototype.reloadEvents=function(){this._drawEvent()},m.prototype.getCurrentDateRange=function(){return[this.monthViewStartDate,this.monthViewEndDate]},m.prototype.setEventBubbles=function(){e(".has-event").removeClass("has-event");for(var t in Calendar.settings.events){var n=moment(Calendar.settings.events[t].start).format(Calendar.settings.ui.year.format),a=moment(Calendar.settings.events[t].start).format(Calendar.settings.ui.month.format),r=moment(Calendar.settings.events[t].start).format("D");e('.year > [data-year="'+n+'"]').addClass("has-event"),calendar.year==moment(Calendar.settings.events[t].start).format("YYYY")&&(e('.month > [data-month="'+a+'"]').addClass("has-event"),calendar.month+1==moment(Calendar.settings.events[t].start).format("M")&&e('.date-selector > .week-date > .day > [data-date="'+r+'"]').addClass("has-event"))}},a.Calendar=a.Calendar||{},a.Calendar={settings:a.settings,yearPicker:null,monthPicker:null,gridLayout:null},Calendar={Init:function(t){this.settings=a.settings,null!=Calendar.settings.ui.year&&null!=Calendar.settings.ui.month&&null!=Calendar.settings.ui.dateHeader&&null!=Calendar.settings.ui.week&&null!=Calendar.settings.ui.grid||alert("You have not included the proper ui[] settings, please refer docs"),this._setLocale(),calendar.monthLong=moment().format(this.settings.ui.month.format),null!=this.settings.now?(calendar.month=moment(a.settings.now).month(),calendar.year=moment(a.settings.now).year(),calendar.date=moment(a.settings.now).format("D"),calendar.dayOfWeek=moment(a.settings.now).day(),calendar.monthLong=moment(a.now).format("MMM")):(calendar.month=moment().month(),calendar.year=moment().year(),calendar.date=moment().format("D"),calendar.dayOfWeek=moment().day(),calendar.monthLong=moment().format("MMM")),Calendar.settings.ui.year.visible||e(".calendar-header").hide(),Calendar.settings.ui.month.visible||e("#months").hide(),Calendar.settings.ui.dateHeader.visible||e("#currentDate").hide(),Calendar.settings.ui.week.visible||e("#weeks-wrapper").hide(),this.yearPicker=new s("#years"),Calendar.settings.weekends||(Calendar.settings.ui.week.startOfTheWeek=1,Calendar.settings.ui.week.endOfTheWeek=5),this.monthPicker=new i("#months"),this._buildCurrentDateHeader(),this.gridLayout=new o(Calendar.settings.view);var n=this.gridLayout.getCurrentDateRange(),r={start:n[0],end:n[1]};a.settings.onViewRenderComplete(r),t||this.bindEventHanders(),this.autoFocusActiveElement(),this.scrollToElement("#weeks-wrapper .active");var d=e(".calendar .options").get(0).getBoundingClientRect().height,l=e(".calendar-header").get(0).getBoundingClientRect().height,c="calc(100% - "+(d+l)+"px)";e("#calendar").css({height:c})},rebuild:function(){Calendar.Init(!0)},_highlightWeek:function(t){e(".week").removeClass("active"),e(t).closest(".week").addClass("active")},_buildCurrentDateHeader:function(){e("#currentDate").text(moment([calendar.year,calendar.month,calendar.date]).format(Calendar.settings.ui.dateHeader.format))},_onYearChange:function(){this._onMonthChange()},_onMonthChange:function(){this._onDayChange()},_onDayChange:function(){this._buildCurrentDateHeader(),null!=this.gridLayout.miniCalendar&&this.gridLayout.miniCalendar.render();var e=this.gridLayout.refresh(),t={start:e[0],end:e[1]};a.settings.onDateChange(t)},_loading:function(){e(".grid .tble").prepend("<div class='loading'><div class='progress progress-small'><div class='progress-bar-indeterminate' style='display: block;'></div></div></div>")},_loaded:function(){e(".grid .tble .loading").remove()},_errorMessage:function(t){e(".grid .tble").prepend("<div class='loading'></div>"),t&&e(".grid .tble .loading").pgNotification({style:"bar",message:t,position:"top",timeout:0,type:"danger",onClosed:function(){e(".grid .tble .loading").remove()}}).show()},dragHandler:function(t){var n=e("#"+t),a=n.parent();if(!e("body").hasClass("mobile")&&1==n.length){e(".drager").scrollbar();a.scrollLeft();interact("#"+t).draggable({preventDefault:"auto",onmove:function(e){var t=e.target,n=(parseFloat(t.getAttribute("data-x"))||0)+e.dx;inverseX=-n,a.scrollLeft(inverseX),t.setAttribute("data-x",n)}})}},autoFocusActiveElement:function(){var t;e(window).resize(function(){clearTimeout(t),t=setTimeout(function(){Calendar.scrollToElement("#weeks-wrapper .active")},500)})},scrollToElement:function(t){
if(t=e(t),0==!t.length){var n=e(t).parent();if(!this._isElementInViewport(t)){var a,r=t.offset().left,s=n.children().width(),i=e(window).width();a=s<i?r-(i/2-s/2):r,e("#weeks-wrapper").parent().animate({scrollLeft:a},10)}}},_isElementInViewport:function(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},dragMoveListener:function(e){var t=e.target,n=(parseFloat(t.getAttribute("data-x"))||0)+e.dx,a=(parseFloat(t.getAttribute("data-y"))||0)+e.dy;t.style.webkitTransform=t.style.transform="translate("+n+"px, "+a+"px)",t.setAttribute("data-x",n),t.setAttribute("data-y",a)},nextMonth:function(){currentYear=moment([calendar.year,calendar.month,calendar.date]).add(1,"months").year(),currentMonth=moment([calendar.year,calendar.month,calendar.date]).add(1,"months").month(),this._refreshViewOnDateChange()},previousMonth:function(){currentYear=moment([calendar.year,calendar.month,calendar.date]).subtract(1,"months").year(),currentMonth=moment([calendar.year,calendar.month,calendar.date]).subtract(1,"months").month(),this._refreshViewOnDateChange()},today:function(){calendar.year=moment().year(),calendar.month=moment().month(),calendar.date=moment().format("D"),this._refreshViewOnDateChange()},_addEvent:function(e){Calendar.settings.events.push(e),this.gridLayout.reloadEvents()},_addEvents:function(e){Calendar.settings.events.concat(e);for(var t=0;t<e.length;t++)Calendar.settings.events.push(e[t]);this.gridLayout.reloadEvents()},_deleteEvent:function(e){if(Calendar.constructEventForUser(e).readOnly)return!1;Calendar.settings.events.splice(parseInt(e),1),this.gridLayout.reloadEvents()},_removeAllEvents:function(){Calendar.settings.events=[]},_updateEvent:function(e){if(Calendar.constructEventForUser(e.index).readOnly)return!1;Calendar.settings.events[e.index]=e,this.gridLayout.reloadEvents()},fitEventsToSlot:function(t){if(1==Calendar.settings.eventOverlap){var n=e(t).children().length,a=e(t).children();if(n>1)for(var r=a.width(),s=0;s<n;s++){e(a[s]).width(r/n);var i=s+1;e(a[i]).css("left",r/2)}else a.width("100%"),e(a).css("left",0)}},_changeView:function(e){this.gridLayout.layout=e,this.settings.view=e,this.gridLayout.rebuild()},_getView:function(){return Calendar.settings.view},timeSlotDblClick:function(e){a.settings.onTimeSlotDblClick(this.gridLayout.doubletap(e))},bindEventHanders:function(){interact(".cell-inner:not(.disable)").on("doubletap",function(t){Calendar.timeSlotDblClick(e(t.currentTarget)),t.preventDefault()}),interact(".event-container").on("tap",function(t){var n=Calendar.constructEventForUser(e(t.currentTarget).attr("data-index"));a.settings.onEventClick(n)})},constructEventForUser:function(e){return{index:e,title:Calendar.settings.events[e].title,"class":Calendar.settings.events[e]["class"],start:Calendar.settings.events[e].start,end:Calendar.settings.events[e].end,allDay:Calendar.settings.events[e].allDay,other:Calendar.settings.events[e].other,readOnly:Calendar.settings.events[e].readOnly}},_setLocale:function(){moment.locale(Calendar.settings.locale)},_refreshViewOnDateChange:function(){this._buildCurrentDateHeader(),this.yearPicker.render(),this.monthPicker.render(),this.gridLayout.refresh(),null!=this.gridLayout.miniCalendar&&this.gridLayout.miniCalendar.render()},_setDate:function(e){calendar.month=moment(e).month(),calendar.year=moment(e).year(),calendar.date=moment(e).format("D"),calendar.dayOfWeek=moment(e).day(),calendar.monthLong=moment(e).format("MMM"),this._refreshViewOnDateChange()},_getDate:function(e){return null==e&&(e="MMMM Do YYYY"),moment([calendar.year,calendar.month,calendar.date]).format(e)},_getEventArray:function(e){if(null==e||"all"==e)return Calendar.settings.events},_getDateRangeInView:function(){return this.gridLayout.getCurrentDateRange()},_scrollToFirstEvent:function(){this.gridLayout.scrollToFirstEvent()}},Calendar.Init(),this};n.prototype.rebuild=function(){Calendar.rebuild()},n.prototype.today=function(){Calendar.today()},n.prototype.next=function(){Calendar.nextMonth()},n.prototype.prev=function(){Calendar.previousMonth()},n.prototype.setDate=function(e){Calendar._setDate(e)},n.prototype.getDate=function(e){return Calendar._getDate(e)},n.prototype.destroy=function(){},n.prototype.setLocale=function(e){Calendar.settings.locale=e,Calendar._setLocale(),Calendar.rebuild()},n.prototype.reloadEvent=function(){Calendar.loadEvents()},n.prototype.addEvent=function(e){Calendar._addEvent(e)},n.prototype.addEvents=function(e){Calendar._addEvents(e)},n.prototype.removeEvent=function(e){Calendar._deleteEvent(e)},n.prototype.removeAllEvents=function(){Calendar._removeAllEvents()},n.prototype.updateEvent=function(e){Calendar._updateEvent(e)},n.prototype.getEvents=function(e){return Calendar._getEventArray(e)},n.prototype.view=function(e){return Calendar._changeView(e)},n.prototype.getView=function(){return Calendar._getView()},n.prototype.getDateRangeInView=function(){return Calendar._getDateRangeInView()},n.prototype.scrollToFirstEvent=function(){return Calendar._scrollToFirstEvent()},n.prototype.setState=function(e){switch(e){case"loading":Calendar._loading();break;case"loaded":Calendar._loaded()}},n.prototype.error=function(e){Calendar._errorMessage(e)};var a=e.fn.pagescalendar;e.fn.pagescalendar=t,e.fn.pagescalendar.Constructor=n,e.fn.pagescalendar.defaults={ui:{year:{visible:!0,format:"YYYY",startYear:"2000",endYear:moment().add(10,"year").format("YYYY"),eventBubble:!0},month:{visible:!0,format:"MMM",eventBubble:!0},dateHeader:{format:"MMMM YYYY, D dddd",visible:!0},week:{day:{format:"D"},header:{format:"dd"},eventBubble:!0,startOfTheWeek:"0",endOfTheWeek:"6",visible:!0},grid:{dateFormat:"D dddd",timeFormat:"h A",eventBubble:!0,scrollToFirstEvent:!1,scrollToAnimationSpeed:300,scrollToGap:20}},eventObj:{editable:!0},view:"week",now:null,locale:"en",timeFormat:"h:mm a",minTime:0,maxTime:24,dateFormat:"MMMM Do YYYY",slotDuration:"30",events:[],eventOverlap:!1,weekends:!0,disableDates:[],onViewRenderComplete:function(){},onEventDblClick:function(){},onEventClick:function(){},onEventRender:function(){},onEventDragComplete:function(){},onEventResizeComplete:function(){},onTimeSlotDblClick:function(){},onDateChange:function(){}},e.fn.pagescalendar.noConflict=function(){return e.fn.pagescalendar=a,this}}(jQuery),function(e,t){"function"==typeof define&&define.amd?define(["moment"],function(n){return e.DateRange=t(n)}):"object"==typeof exports?module.exports=t(require("moment")):e.DateRange=t(moment)}(this,function(e){function t(t,n){var a,r=t,s=n;1!==arguments.length&&n!==undefined||("object"==typeof t&&2===t.length?(r=t[0],s=t[1]):"string"==typeof t&&(a=t.split("/"),r=a[0],s=a[1])),this.start=e(null===r?-864e13:r),this.end=e(null===s?864e13:s)}function n(t,n,a){for(var r=e(this.start);this.contains(r,a);)n.call(this,r.clone()),r.add(1,t)}function a(t,n,a){var r=this/t,s=Math.floor(r);if(s!==Infinity){s===r&&a&&s--;for(var i=0;i<=s;i++)n.call(this,e(this.start.valueOf()+t.valueOf()*i))}}var r={year:!0,month:!0,week:!0,day:!0,hour:!0,minute:!0,second:!0};return t.prototype.constructor=t,t.prototype.clone=function(){return e().range(this.start,this.end)},t.prototype.contains=function(e,n){var a=this.start,r=this.end;return e instanceof t?a<=e.start&&(r>e.end||r.isSame(e.end)&&!n):a<=e&&(r>e||r.isSame(e)&&!n)},t.prototype.overlaps=function(e){return null!==this.intersect(e)},t.prototype.intersect=function(e){var n=this.start,a=this.end;return n<=e.start&&e.start<a&&a<e.end?new t(e.start,a):e.start<n&&n<e.end&&e.end<=a?new t(n,e.end):e.start<n&&n<=a&&a<e.end?this:n<=e.start&&e.start<=e.end&&e.end<=a?e:null},t.prototype.add=function(n){return this.overlaps(n)?new t(e.min(this.start,n.start),e.max(this.end,n.end)):null},t.prototype.subtract=function(e){var n=this.start,a=this.end;return null===this.intersect(e)?[this]:e.start<=n&&n<a&&a<=e.end?[]:e.start<=n&&n<e.end&&e.end<a?[new t(e.end,a)]:n<e.start&&e.start<a&&a<=e.end?[new t(n,e.start)]:n<e.start&&e.start<e.end&&e.end<a?[new t(n,e.start),new t(e.end,a)]:n<e.start&&e.start<a&&e.end<a?[new t(n,e.start),new t(e.start,a)]:void 0},t.prototype.toArray=function(e,t){var n=[];return this.by(e,function(e){n.push(e)},t),n},t.prototype.by=function(e,t,r){return"string"==typeof e?n.call(this,e,t,r):a.call(this,e,t,r),this},t.prototype.toString=function(){return this.start.format()+"/"+this.end.format()},t.prototype.valueOf=function(){return this.end-this.start},t.prototype.center=function(){var t=this.start+this.diff()/2;return e(t)},t.prototype.toDate=function(){return[this.start.toDate(),this.end.toDate()]},t.prototype.isSame=function(e){return this.start.isSame(e.start)&&this.end.isSame(e.end)},t.prototype.diff=function(e){return this.end.diff(this.start,e)},e.range=function(n,a){return n in r?new t(e(this).startOf(n),e(this).endOf(n)):new t(n,a)},e.range.constructor=t,e.fn.range=e.range,e.fn.within=function(e){return e.contains(this._d)},t});